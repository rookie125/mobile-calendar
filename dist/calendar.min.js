!function(t){var e="undefined"!=typeof window?window:this;"object"==typeof module&&"object"==typeof module.exports?module.exports=e.document?t(e):function(e){if(!e.document)throw new Error("document is a undefined");return t(e)}:t(e)}(function(t){function e(){var t=new Date;this.past=!1,this.hours=!1,this.hoursPast=!1,this.currentNode=null,this.shield="[]",this.startDate="",this.startJSON={},this.fixDate={y:t.getFullYear(),m:t.getMonth()+1,d:0},this.init()}function a(t,e){function a(a){function n(t){if(L)return!1;var a=t.targetTouches?ev.targetTouches[0]:t||event;return i=a.pageX-o,Math.abs(i)>=c&&(L=!0,e&&e(d,i)),a.preventDefault&&a.preventDefault(),!1}function s(){this.onmousemove&&(this.onmousemove=null),this.onmouseup&&(this.onmouseup=null),this.removeEventListener("touchmove",n,!1),this.removeEventListener("touchend",s,!1),L=!1}var i,r=a.targetTouches?ev.targetTouches[0]:a||event,o=r.pageX,c=parseInt(document.documentElement.clientWidth/5,10),d=this;this.onmousemove=n,this.onmouseup=s,t.addEventListener("touchmove",n,!1),t.addEventListener("touchend",s,!1)}t.onmousedown=a,t.addEventListener("touchstart",a,!1)}function n(t,e,a){return new Date(t,e,a,23,59,59).getTime()}function s(t,e){switch(e.charAt(0)){case"#":return t.querySelector(e);case".":return t.querySelectorAll(e);default:return t.querySelectorAll(e)}}function i(t,e,a){if(t){e=e||{},a=a||"";var n=document.createElement(t);for(var s in e)n.setAttribute(s,e[s]);return n.innerHTML=a,n}}function r(){D.classList.add("close"),setTimeout(function(){D.classList.remove("active","close")},290)}function o(t,e){if(!t)return!1;var a=e||"y/m/d",n=t.split("/"),s=a.match(/[^a-z\d]/i)[0],i={y:n[0],m:d(n[1]),d:d(n[2])};return a.split(/[^a-z]/i).map(function(t){return i[t.charAt(0).toLocaleLowerCase()]}).join(s)}function c(t){if(t){var e=[];return/^\[|\]$/.test(t)?e=JSON.parse(t.replace(/\'/g,'"')):/^\d+[\/-]\d+[\/-]\d+$/.test(t)&&(e=[t]),e.map(function(t){var e=new Date(t+" 23:59:59");return{y:e.getFullYear(),m:e.getMonth()+1,d:e.getDate()}})}}function d(t){return Number(t)<10?"0"+t:t}function l(t,e,a){switch(arguments.length){case 3:t.setAttribute(e,a);break;case 2:return t.getAttribute(e)}}var h,u,p,v,f,m,y,g=0,w=0,L=!1,D=i("div",{"class":"calendar"}),x=i("div",{"class":"calendar-mask"}),C=i("div",{"class":"calendar-content"}),N=i("div",{"class":"calendar-list"});return e.prototype.init=function(){var t=this,e=document.querySelectorAll(".calendars");if(e.length){D.appendChild(x),D.appendChild(C),document.body.appendChild(D),this.createHeader(function(){this.createWeek(),C.appendChild(N),a(N,function(t,e){e>0?g--:g++,this.startJSON.prev.m=g-1,this.startJSON.now.m=g,this.startJSON.next.m=g+1,this.transitions(t,e)}.bind(this)),h.forEach(function(t){t.onclick=function(){this.classList.contains("calendar-month-txt")?(y.classList.toggle("active"),m.show&&(m.show=!1,m.classList.remove("active")),u.forEach(function(t){l(t,"data-value")===l(this,"data-value")?t.classList.add("active"):t.classList.remove("active")}.bind(this)),y.show=!y.show):this.classList.contains("calendar-year-txt")&&(m.classList.toggle("active"),y.show&&(y.classList.remove("active"),y.show=!1),p.forEach(function(t){var e=t.classList;l(t,"data-value")===l(this,"data-value")?e.add("active"):e.remove("active")}.bind(this)),m.show=!m.show)}})}.bind(this)),this.createDate({},function(e){for(var a=0;a<u.length;a++)e[a].onclick=function(){for(var a=0;a<e.length;a++)e[a].classList.remove("active");g+=l(this,"data-value")-l(f,"data-value"),t.selectDate(this,y,"m",g)}});for(var n=0;n<e.length;n++)l(e[n],"readonly","true"),e[n].addEventListener("focus",function(){if(null==l(this,"disabled")){var e=Number(l(this,"start-year"))||1915,n=Number(l(this,"end-year"))||2050;t.hours=!(null==l(this,"hours")),t.hoursPast=!(null==l(this,"hours-past")),t.past=!(null==l(this,"past"))||t.hoursPast,t.shield=c(l(this,"shield")||""),t.startDate=c(l(this,"start-date")||"");var s,i,r,o=new Date;if(t.startDate instanceof Array&&t.startDate.length){var d=t.startDate[0];w=d.y-o.getFullYear(),g=d.m-(o.getMonth()+1);for(var h in d)t.fixDate[h]=d[h];s={y:w,m:g-1,d:d.d},i={y:w,m:g,d:d.d},r={y:w,m:g+1,d:d.d},t.startJSON={prev:s,now:i,next:r}}else t.fixDate.y=o.getFullYear(),t.fixDate.m=o.getMonth()+1,t.fixDate.d=0;t.currentNode!=this&&((!t.startDate instanceof Array||!t.startDate)&&(w=g=0,t.startJSON.prev={y:w,m:g-1},t.startJSON.now={y:w,m:g},t.startJSON.next={y:w,m:g+1}),t.appendList(t.startJSON,t.addEvent.bind(t)),t.createDate({start:e,end:n,type:"year"},function(e){for(var n=0;n<e.length;n++)e[n].onclick=function(){for(var a=0;a<e.length;a++)e[a].classList.remove("active");w+=l(this,"data-value")-l(v,"data-value"),t.selectDate(this,m,"y",w)};a(m,function(t,e){m.index=m.index||0;var a=m.children.length;e>0?(m.index++,m.index>=0&&(m.index=0)):(m.index--,m.index<=-a&&(m.index=-(a-1)));var n="translate3D("+m.index*(100/a)+"%, 0, 0)";m.style.WebkitTransform=n,m.style.transform=n})})),D.classList.add("active"),t.currentNode=this}});C.onclick=function(t){var e=t.targetTouches?t.targetTouches[0]:t||event;e.cancelBubble=!0},x.onclick=r}},e.prototype.createCalenList=function(t,e){function a(t,e,a){if(!s.shield)return!1;for(var n=0;n<s.shield.length;n++)if(s.shield[n].y=s.shield[n].y||h.getFullYear(),s.shield[n].m=s.shield[n].m||h.getMonth()+1,s.shield[n].d=s.shield[n].d||h.getDate(),t==s.shield[n].y&&e==s.shield[n].m&&a==s.shield[n].d)return!0;return!1}var s=this,r=document.createElement("div"),o=0,c=t.y||0,d=t.m||0,h=(t.d,new Date);h.setFullYear(h.getFullYear()+c,h.getMonth()+d+1,1),h.setDate(0);var u=h.getDate();h.setDate(1);var p=h.getDay(),h=new Date,m=h.getDate();h.setFullYear(h.getFullYear()+c,h.getMonth()+d,1);var y=h.getFullYear(),g=h.getMonth()+1;h.setDate(0);for(var w=h.getDate(),L=[],D=w;D>0;D--)L.push(D);e&&(v.innerHTML=y,f.innerHTML=g<10?"0"+g:g,l(v,"data-value",y),l(f,"data-value",g-1));var x=p+7;x=x>=10?x-7:x;for(var D=0;D<x;D++){var C=i("span"),N=i("a",{"data-calen":[y,g-1,L[D]].join("/"),"class":"prev-m prev-to-month pasted",href:"javascript:;"},L[D]);C.appendChild(N),0!==r.children.length?r.insertBefore(C,r.children[0]):r.appendChild(C),o++}for(var b=n(y,g,m),D=0;D<u;D++){o++;var S=D+1,C=i("span"),N=i("a",{"data-calen":[y,g,S].join("/"),href:"javascript:;"},S);new Date;o%7!==0&&o%7!==1||N.classList.add("weekend");var j=n(c+y,d+g,S);s.past&&j<b?N.classList.add("expire","pasted"):(j===b||s.fixDate.y===y&&s.fixDate.m===g&&s.fixDate.d===S)&&N.classList.add("today"),a(y,g,S)&&N.classList.add("pasted","shield"),C.appendChild(N),r.appendChild(C)}for(var k=42-r.children.length,D=0;D<k;D++){var S=D+1,C=i("span"),N=i("a",{"data-calen":[y,g+1,S].join("/"),"class":"next-m next-to-month pasted",href:"javascript:;"},S);C.appendChild(N),r.appendChild(C)}return r},e.prototype.createDate=function(t,e){t=t||{},t.start=t.start||1,t.end=t.end||12,t.type=t.type||"month";for(var a=i("div",{"class":"month"==t.type?"calendar-months":"calendar-years"}),n=i("div"),s=[],r=0,o=0,c=0,d=(new Date).getFullYear(),l=t.start;l<=t.end;l++){var h=i("span"),v=i("a",{"data-value":"year"==t.type?l:l-1,href:"javascript:;"},l<10?"0"+l:l);s.push(v),"year"==t.type?(r>=12&&(a.appendChild(n),n=i("div"),r=0,o++),l==d&&(c=o),h.appendChild(v),n.appendChild(h)):(h.appendChild(v),a.appendChild(h)),r++}if("year"==t.type){m&&C&&C.removeChild(m),a.appendChild(n),m=a,p=s,r&&o++,a.style.width=100*o+"%";for(var l=0;l<o;l++)a.children[l].style.width=100/o+"%";a.style.WebkitTransform="translate3D(-"+c*(100/o)+"%, 0, 0)",a.style.transform="translate3D(-"+c*(100/o)+"%, 0, 0)",m.index=-c}else y&&C&&C.removeChild(y),y=a,u=s;C.appendChild(a),e&&e(s)},e.prototype.createTime=function(t,e,a){var n=s(C,".calendar-time"),o=[],c=new Date,d=c.getDate(),h=c.getHours(),u=this;if(n.length){n=n[0];for(var p=s(n,"a"),v=0;v<p.length;v++)o.push({obj:p[v],time:parseInt(l(p[v],"data-time"),10)})}else{n=i("div",{"class":"calendar-time"});for(var v=0;v<24;v++){var f=v<10?"0"+v:v;f+=":00";var m=i("span"),y=i("a",{href:"javascript:;","data-time":f},f);m.appendChild(y),n.appendChild(m),o.push({obj:y,time:parseInt(f,10)})}}n.classList.add("active"),o.forEach(function(s){u.hoursPast&&(g<0&&w<=0||a==d&&s.time<=h||g<=0&&w<=0&&a<d)?(s.obj.classList.add("expire","pasted"),s.obj.active=!1):(s.obj.classList.remove("expire","pasted"),s.obj.active=!0),s.obj.onclick=function(){if(this.active){var a=e+" "+(s.time<10?"0"+s.time:s.time)+":00";null!==t.value?t.value=a:null!=t.innerHTML&&(t.innerHTML=a),r(),u.changes()}n.classList.remove("active")}}),C.appendChild(n)},e.prototype.createHeader=function(t){h=h||[];var e=this,a=i("div",{"class":"calendar-header"}),n=i("div",{"class":"calendar-year"}),s=i("a",{"class":"year-prev switch-btn",href:"javascript:;"},"&lt;"),r=i("a",{"class":"year-next switch-btn",href:"javascript:;"},"&gt;"),o=i("a",{"class":"calendar-year-txt calendar-title",href:"javascript:;"});n.appendChild(s),n.appendChild(o),n.appendChild(r);var c=i("div",{"class":"calendar-month"}),d=i("a",{"class":"month-prev switch-btn",href:"javascript:;"},"&lt;"),l=i("a",{"class":"month-next switch-btn",href:"javascript:;"},"&gt;"),u=i("a",{"class":"calendar-month-txt calendar-title",href:"javascript:;"});c.appendChild(d),c.appendChild(u),c.appendChild(l),a.appendChild(n),a.appendChild(c),h.push(o,u),f=u,v=o,d.onclick=function(){e.switchDate(-1)},l.onclick=function(){e.switchDate(1)},s.onclick=function(){e.switchDate(-1,"year")},r.onclick=function(){e.switchDate(1,"year")},C.children.length?C.insertBefore(a,C.children[0]):C.appendChild(a);for(var p=0;p<a.children.length;p++)a.children[p].ontouchstart=function(){this.classList.add("active")},a.children[p].ontouchend=function(){this.classList.remove("active")};t&&t()},e.prototype.createWeek=function(){for(var t=i("div",{"class":"calendar-week"}),e="日一二三四五六",a=0;a<7;a++){var n=a+1,s={};n%7!=1&&n%7!=0||(s["class"]="weekend"),t.appendChild(i("span",s,e.charAt(a)))}C.appendChild(t)},e.prototype.appendList=function(t,e){t=t||{},t.prev=t.prev||{m:g-1,y:w},t.now=t.now||{m:g,y:w},t.next=t.next||{m:g+1,y:w},N.innerHTML="",N.appendChild(this.createCalenList(t.prev)),N.appendChild(this.createCalenList(t.now,!0)),N.appendChild(this.createCalenList(t.next)),e&&e()},e.prototype.addEvent=function(){var t=this;N.querySelectorAll("a").forEach(function(e){e.onclick=function(){var e=this.classList;if(e.contains("prev-to-month"))t.switchDate(-1);else if(e.contains("next-to-month"))t.switchDate(1);else if(!e.contains("pasted")&&!e.contains("shield")){var a=l(this,"data-calen"),n=o(a,l(t.currentNode,"format")||!1);if(t.hours){var s=this.innerHTML;t.createTime(t.currentNode,n,s)}else t.currentNode&&(void 0===t.currentNode.value?t.currentNode.innerHTML=n:t.currentNode.oldValue!==n&&(t.currentNode.value=n,t.currentNode.oldValue=n,t.changes())),r()}}})},e.prototype.switchDate=function(t,e){var a=this;switch(e=e||"month"){case"month":t>0?g++:g--,a.startJSON.prev.m=g-1,a.startJSON.now.m=g,a.startJSON.next.m=g+1,a.transitions(N,t>0?-1:1);break;case"year":a.appendList({prev:{m:g,y:w-1},next:{m:g,y:w+1}},function(){t>0?w++:w--,a.startJSON.prev.y=w,a.startJSON.now.y=w,a.startJSON.next.y=w,a.transitions(N,t>0?-1:1)})}},e.prototype.transitions=function(t,e){t.classList.add("silde",e>0?"prev-to":"next-to"),setTimeout(function(){this.appendList(this.startJSON,function(){t.classList.remove("silde","prev-to","next-to"),this.addEvent()}.bind(this))}.bind(this),500)},e.prototype.selectDate=function(t,e,a,n){var s=this;this.startJSON.prev[a]="m"==a?n-1:n,this.startJSON.now[a]=n,this.startJSON.next[a]="m"==a?n+1:n,this.appendList(this.startJSON,s.addEvent.bind(this)),t.classList.add("active"),e.classList.remove("active"),m.show=!1,y.show=!1},e.prototype.changes=function(){var e=t.jQuery||t.$||null;e?e(this.currentNode)&&e(this.currentNode).change&&e(this.currentNode).change():this.currentNode.onchange&&this.currentNode.onchange()},t.addEventListener("load",function(){new e},!1),e});